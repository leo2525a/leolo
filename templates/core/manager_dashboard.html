{% extends 'core/base.html' %}
{% load custom_filters %}

{% block title %}Manager Dashboard{% endblock %}

{% block extra_css %}
<style>
    .btn-primary {
    background-color: #007bff;
    color: white;
    padding: 10px 15px;
    text-decoration: none;
    border-radius: 5px;
    font-weight: 500;
    }

    .request-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    .request-table th, .request-table td {
        border: 1px solid #ddd;
        padding: 12px;
        text-align: left;
    }
    .request-table th {
        background-color: #f2f2f2;
    }
    .actions a {
        color: #fff;
        padding: 8px 12px;
        border-radius: 4px;
        text-decoration: none;
        font-size: 0.9rem;
        margin-right: 5px;
    }
    .approve-btn {
        background-color: #28a745;
    }
    .reject-btn {
        background-color: #dc3545;
    }
    .calendar-container {
        margin-top: 40px;
    }
    .calendar {
        width: 100%;
        border-collapse: collapse;
    }
    .calendar th, .calendar td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
        vertical-align: top;
        height: 80px;
    }
    .calendar th {
        background-color: #f2f2f2;
        height: auto;
    }
    .calendar .day-number {
        font-weight: bold;
        text-align: right;
        display: block;
    }
    .calendar .noday {
        background-color: #f9f9f9;
    }
    .calendar .today .day-number {
        background-color: #007bff;
        color: white;
        border-radius: 50%;
        width: 2em;
        height: 2em;
        line-height: 2em;
        text-align: center;
        display: inline-block;
    }
    .on-leave {
        font-size: 0.8rem;
        background-color: #e2e3e5;
        color: #495057;
        padding: 2px 4px;
        border-radius: 3px;
        display: block;
        margin-top: 5px;
        text-align: left;
    }
</style>
{% endblock %}

{% block content %}

    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1>åœ˜éšŠå„€è¡¨æ¿</h1>
        <a href="{% url 'core:edit_team_schedule' %}" class="btn-primary">ç·¨è¼¯ä¸‹é€±ç­è¡¨</a>
        <a href="{% url 'core:manual_attendance' %}" class="btn-secondary">æ‰‹å‹•è£œç™»æ‰“å¡</a> <!-- ğŸ‘ˆ ç‚ºç¶“ç†æ–°å¢ -->
    </div>
    <hr>

    <h2>åœ˜éšŠä¼‘å‡å¯©æ‰¹</h2>

    {% if messages %}
        <div class="messages" style="margin-top: 15px;">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
        </div>
    {% endif %}

    <p>ä»¥ä¸‹æ˜¯æ‚¨åœ˜éšŠæˆå“¡æäº¤çš„å¾…å¯©æ ¸ä¼‘å‡ç”³è«‹ã€‚</p>

    {% if pending_leaves %}
        <div class="table-responsive">
            <table class="request-table">
                <thead>
                    <tr>
                        <th>ç”³è«‹äºº</th>
                        <th>å‡åˆ¥</th>
                        <th>èµ·è¨–æ—¥æœŸ</th>
                        <th>ç”³è«‹äº‹ç”±</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for request in pending_leaves %}
                        <tr>
                            <td>{{ request.employee.user.get_full_name }}</td>
                            <td>{{ request.leave_type.name }}</td>
                            <td>{{ request.start_datetime|date:"Y-m-d H:i" }} to {{ request.end_datetime|date:"Y-m-d H:i" }}</td>                            <td>{{ request.reason }}</td>
                            <td class="actions">
                                <a href="{% url 'core:leave_approve' request.id %}" class="approve-btn">æ‰¹å‡†</a>
                                <a href="{% url 'core:leave_reject' request.id %}" class="reject-btn">æ‹’çµ•</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p style="margin-top: 20px;">ç›®å‰æ²’æœ‰å¾…å¯©æ ¸çš„ç”³è«‹ã€‚</p>
    {% endif %}

    <hr style="margin-top: 40px; margin-bottom: 40px;">
    <h2>åœ˜éšŠåŠ ç­å¯©æ‰¹</h2>
    <p>æ‰¹å‡†å¾Œï¼ŒåŠ ç­æ™‚æ•¸å°‡è‡ªå‹•è½‰ç‚ºå“¡å·¥çš„è£œä¼‘æ™‚æ•¸ã€‚</p>

    {% if pending_overtime %}
        <div class="table-responsive">
            <table class="request-table">
                <thead>
                    <tr>
                        <th>ç”³è«‹äºº</th>
                        <th>åŠ ç­æ—¥æœŸ</th>
                        <th>åŠ ç­æ™‚æ•¸</th>
                        <th>åŠ ç­äº‹ç”±</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ot in pending_overtime %}
                        <tr>
                            <td>{{ ot.employee.user.get_full_name }}</td>
                            <td>{{ ot.date }}</td>
                            <td>{{ ot.hours }} å°æ™‚</td>
                            <td>{{ ot.reason }}</td>
                            <td class="actions">
                                <a href="{% url 'core:overtime_approve' ot.id %}" class="approve-btn">æ‰¹å‡†</a>
                                <a href="{% url 'core:overtime_reject' ot.id %}" class="reject-btn">æ‹’çµ•</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p style="margin-top: 20px;">ç›®å‰æ²’æœ‰å¾…å¯©æ ¸çš„åŠ ç­ç”³è«‹ã€‚</p>
    {% endif %}
    
    <hr style="margin-top: 40px; margin-bottom: 40px;">
    <h2>å¾…è™•ç†çš„ç¸¾æ•ˆè©•ä¼°</h2>
    <p>ä»¥ä¸‹æ˜¯æ‚¨åœ˜éšŠæˆå“¡å·²æäº¤æˆ–é€²è¡Œä¸­çš„ç¸¾æ•ˆè©•ä¼°ã€‚</p>

    {% if pending_reviews %}
        <table class="request-table">
            <thead>
                <tr>
                    <th>è©•ä¼°é€±æœŸ</th>
                    <th>å“¡å·¥</th>
                    <th>ç‹€æ…‹</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for review in pending_reviews %}
                    <tr>
                        <td>{{ review.cycle.name }}</td>
                        <td>{{ review.employee.user.get_full_name }}</td>
                        <td>{{ review.status }}</td>
                        <td>
                            <a href="{% url 'core:manager_review_detail' review.id %}" class="approve-btn">é€²å…¥è©•ä¼°</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>ç›®å‰æ²’æœ‰å¾…è™•ç†çš„ç¸¾æ•ˆè©•ä¼°ã€‚</p>
    {% endif %}

    

    <div class="calendar-container">
        <h3>åœ˜éšŠå‡æœŸæœˆæ›†</h3>
        <table class="calendar">
            <thead>
                <tr>
                    <th>æ—¥</th>
                    <th>ä¸€</th>
                    <th>äºŒ</th>
                    <th>ä¸‰</th>
                    <th>å››</th>
                    <th>äº”</th>
                    <th>å…­</th>
                </tr>
            </thead>
            <tbody>
                {% for week in month_days %}
                    <tr>
                        {% for day in week %}
                            {% with day_ordinal=day.toordinal %}
                                <td class="{% if day.month != today_ordinal.month %}noday{% endif %} {% if day_ordinal == today_ordinal %}today{% endif %}">
                                    <div class="day-number">{{ day.day }}</div>
                                    <div class="leave-events">
                                        {% if leave_dates|get_item:day_ordinal %}
                                            {% for name in leave_dates|get_item:day_ordinal %}
                                                <span class="on-leave">{{ name }}</span>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                </td>
                            {% endwith %}
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}